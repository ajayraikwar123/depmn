<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>All fees data</title>
  <style>
    body{
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(to right,#74ebd5,#ACB6E5);
      padding:40px;color:#333;
    }
    h1{text-align:center;color:#222;margin-bottom:10px;font-size:2.5em;text-shadow:1px 1px 2px #fff;}
    #timestamp{text-align:center;margin-bottom:20px;font-size:14px;color:#555;}

    #searchInput{
      display:block;width:100%;max-width:500px;margin:0 auto 20px;
      padding:12px 16px;font-size:16px;border-radius:8px;border:1px solid #ccc;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    #downloadBtn{
      display:block;margin:0 auto 30px;padding:10px 20px;font-size:16px;
      background:#3498db;color:#fff;border:none;border-radius:6px;cursor:pointer;
      box-shadow:0 4px 6px rgba(0,0,0,0.1);
    }

    table{
      width:100%;max-width:1100px;margin:0 auto;border-collapse:collapse;
      background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 0 20px rgba(0,0,0,0.15);
    }
    th,td{padding:14px 20px;border-bottom:1px solid #eee;text-align:left;}
    th{background:#3498db;color:#fff;font-weight:bold;text-transform:uppercase;letter-spacing:0.5px;}
    tr:hover{background:#f1f1f1;transition:background-color 0.3s;}
    tr.total-row{background:#fdf6e3;font-weight:bold;}

    /* --- PDFâ€‘only header --- */
    #pdfHeader{
      display:none;              /* hidden on screen */
      margin-bottom:20px;
      justify-content:center;    /* center the group */
      align-items:center;
      gap:16px;                  /* space between logo & text */
    }
    #pdfHeader img{height:60px;width:auto;}
    #pdfHeader h2{margin:0;font-size:22px;color:#333;}

    @media(max-width:768px){
      th,td{padding:10px;font-size:14px;}
      #searchInput{width:90%;}
    }
  </style>
</head>
<body>

  <h1 id="pageTitle">Dep MN Fees Records</h1>
  <div id="timestamp"></div>

  <input type="text" id="searchInput" placeholder="ðŸ” Search table...">
  <button id="downloadBtn">ðŸ“„ Download PDF</button>

  <!-- header visible only inside the PDF -->
  <div id="pdfHeader">
    <img src="logo.jpg" alt="Logo">
    <h2>VIDYA DEP-MN 2025-26</h2>
  </div>

  <div id="tableContainer">
    <table id="sheet-data"></table>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    const sheetID="1DOqO1pb70jF77ZOvuQ6EHROdlztHmGFQNtQsG7VrqL8";
    const sheetName="showfees";
    const url=`https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
    let amountColumnIndex=-1;

    document.getElementById("timestamp").textContent=
      `Report generated on: ${new Date().toLocaleString('en-IN',{dateStyle:'medium',timeStyle:'short'})}`;

    fetch(url).then(r=>r.text()).then(rep=>{
      const data=JSON.parse(rep.substring(47).slice(0,-2));
      const table=document.getElementById("sheet-data");

      /* headers */
      const headerRow=document.createElement("tr");
      data.table.cols.forEach((col,i)=>{
        if(col.label){
          const th=document.createElement("th");th.textContent=col.label;headerRow.appendChild(th);
          if(/amount|fees/i.test(col.label)) amountColumnIndex=i;
        }
      });
      table.appendChild(headerRow);

      /* rows */
      data.table.rows.forEach(row=>{
        const tr=document.createElement("tr");
        row.c.forEach((cell)=>{const td=document.createElement("td");td.textContent=cell?cell.v:"";tr.appendChild(td);});
        table.appendChild(tr);
      });
      appendTotalRow();updateTotalRow();

      document.getElementById("searchInput").addEventListener("keyup",function(){
        const filter=this.value.toLowerCase();
        document.querySelectorAll("#sheet-data tr:not(:first-child):not(.total-row)").forEach(row=>{
          row.style.display=row.textContent.toLowerCase().includes(filter)?"":"none";
        });
        updateTotalRow();
      });

      function appendTotalRow(){
        const totalRow=document.createElement("tr");
        totalRow.className="total-row";totalRow.id="totalRow";
        for(let i=0;i<amountColumnIndex;i++) totalRow.appendChild(document.createElement("td"));
        totalRow.appendChild(Object.assign(document.createElement("td"),{textContent:"Total:"}));
        totalRow.appendChild(Object.assign(document.createElement("td"),{id:"totalValueCell",textContent:"â‚¹0.00"}));
        for(let i=0;i<data.table.cols.length-amountColumnIndex-2;i++) totalRow.appendChild(document.createElement("td"));
        table.appendChild(totalRow);
      }

      function updateTotalRow(){
        let total=0;
        document.querySelectorAll("#sheet-data tr:not(:first-child):not(.total-row)").forEach(r=>{
          if(r.style.display!=="none"){
            const val=r.children[amountColumnIndex]?.textContent||"0";
            const num=parseFloat(val.replace(/[^0-9.-]/g,""));if(!isNaN(num)) total+=num;
          }
        });
        document.getElementById("totalValueCell").textContent=
          total.toLocaleString('en-IN',{style:'currency',currency:'INR'});
      }
    }).catch(err=>console.error("Sheet load error:",err));

    /* ---- PDF export ---- */
    document.getElementById("downloadBtn").addEventListener("click",()=>{
      const hide=(el)=>el.style.display="none";
      const show=(el,disp)=>el.style.display=disp;

      const heading=document.getElementById("pageTitle");
      const button=document.getElementById("downloadBtn");
      const timestamp=document.getElementById("timestamp");
      const pdfHeader=document.getElementById("pdfHeader");

      hide(heading);hide(button);hide(timestamp);show(pdfHeader,"flex");

      const d=new Date(),dd=d.getDate().toString().padStart(2,"0"),mm=(d.getMonth()+1).toString().padStart(2,"0"),yyyy=d.getFullYear();
      const filename=`DEP_MN_Fees_Record_${dd}-${mm}-${yyyy}.pdf`;

      html2pdf().from(document.body)
        .set({margin:0.5,filename,html2canvas:{scale:2},jsPDF:{unit:'in',format:'letter',orientation:'landscape'}})
        .save()
        .then(()=>{show(heading,"block");show(button,"block");show(timestamp,"block");hide(pdfHeader);});
    });
  </script>
</body>
</html>
